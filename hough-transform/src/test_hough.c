#include <stdio.h>
#include <stdlib.h>
#include "hough_tests.h"

void create_test_status_data(tim571_status_data *data)
{
  data->firmware_version = 1;
  data->sopas_device_id = 1;
  data->serial_number = 18150133;
  data->error = 0;
  data->scanning_frequency = 1500;
  data->scanning_frequency = 1500;
  data->multiplier = 1.000;
  data->starting_angle = -450000;
  data->angular_step = 3333;
  data->data_count = 811;
  data->rssi_available = 1;
}

void create_test_distance(uint16_t *distance)
{
  uint16_t dump[] = {
    3793, 3812, 3821, 3867, 3830, 3786, 3747, 3717, 3683, 3652,
    3621, 3592, 3561, 3533, 3504, 3478, 3448, 3424, 3400, 3373,
    3346, 3323, 3297, 3274, 3248, 3228, 3202, 3182, 3159, 3143,
    3119, 3102, 3080, 3062, 3041, 3024, 3004, 2983, 2966, 2949,
    2935, 2915, 2897, 2881, 2866, 2851, 2839, 2823, 2807, 2792,
    2781, 2764, 2749, 2738, 2724, 2709, 2696, 2685, 2673, 2656,
    2648, 2635, 2624, 2610, 2602, 2586, 2578, 2565, 2555, 2545,
    2535, 2525, 2514, 2504, 2499, 2483, 2478, 2465, 2459, 2450,
    2447, 2504, 2435, 2432, 2433, 2428, 2423, 2414, 2408, 2394,
    2388, 2376, 2370, 2360, 2354, 2346, 2340, 2332, 2327, 2321,
    2315, 2312, 2303, 2298, 2291, 2290, 2280, 2276, 2273, 2266,
    2261, 2257, 2251, 2254, 2248, 2246, 2240, 2239, 2234, 2231,
    2227, 2223, 2217, 2214, 2212, 2206, 2207, 2202, 2199, 2192,
    2187, 2183, 2183, 2176, 2178, 2171, 2174, 2167, 2170, 2166,
    2164, 2159, 2165, 2159, 2161, 2158, 2157, 2155, 2156, 2153,
    2154, 2154, 2149, 2153, 2152, 2154, 2157, 2154, 2151, 2147,
    2148, 2153, 2155, 2151, 2155, 2147, 2150, 2153, 2148, 2152,
    2155, 2157, 2158, 2154, 2154, 2156, 2157, 2160, 2164, 2163,
    2160, 2160, 2164, 2167, 2167, 2170, 2173, 2171, 2179, 2179,
    2180, 2180, 2187, 2189, 2188, 2195, 2196, 2196, 2200, 2205,
    2205, 2211, 2214, 2214, 2222, 2223, 2228, 2229, 2232, 2236,
    2239, 2243, 2246, 2250, 2251, 2254, 2260, 2264, 2268, 2272,
    2275, 2282, 2288, 2293, 2295, 2299, 2306, 2312, 2318, 2319,
    2325, 2332, 2340, 2344, 2350, 2357, 2362, 2368, 2375, 2378,
    2385, 2394, 2404, 2403, 2411, 2419, 2425, 2438, 2441, 2449,
    2457, 2466, 2475, 2481, 2491, 2499, 2506, 2516, 2523, 2532,
    2543, 2553, 2562, 2574, 2581, 2594, 2601, 2616, 2622, 2635,
    2655, 2668, 2679, 2689, 2699, 2709, 2717, 2733, 2743, 2754,
    2761, 2776, 2787, 2799, 2811, 2824, 2839, 2852, 2862, 2874,
    2887, 2902, 2915, 2930, 2941, 2962, 2975, 2990, 3006, 3025,
    3035, 3052, 3070, 3084, 3102, 3117, 3140, 3155, 3173, 3193,
    3212, 3227, 3250, 3271, 3293, 3313, 3338, 1906, 1967, 1975,
    1974, 1972, 1974, 1974, 1978, 1980, 1982, 1982, 1983, 1985,
    1990, 1989, 1996, 1996, 1994, 1997, 1999, 1845, 3126, 3101,
    3093, 3082, 3069, 3061, 3051, 3043, 3033, 3024, 3015, 3003,
    2995, 2986, 2977, 2968, 2957, 2970, 2971, 2961, 2952, 2946,
    2935, 2931, 2924, 2916, 2912, 2903, 2889, 2886, 2877, 2873,
    2863, 2859, 2853, 2848, 2837, 2832, 2830, 2822, 2813, 2810,
    2806, 2802, 2794, 2789, 2784, 2779, 2776, 2769, 2767, 2763,
    2759, 2751, 2749, 2744, 2735, 2737, 2731, 2728, 2724, 2719,
    2720, 2714, 2717, 2712, 2708, 2707, 2695, 2698, 2702, 2692,
    2692, 2685, 2684, 2681, 2683, 2680, 2678, 2672, 2674, 2670,
    2671, 2667, 2666, 2664, 2660, 2664, 2666, 2664, 2658, 2654,
    2660, 2658, 2657, 2651, 2652, 2655, 2657, 2668, 2653, 2659,
    2652, 2657, 2657, 2655, 2659, 2662, 2658, 2659, 2663, 2660,
    2667, 2664, 2671, 2666, 2664, 2664, 2671, 2686, 2678, 2679,
    2680, 2680, 2684, 2686, 2685, 2688, 2692, 2691, 2699, 2701,
    2696, 2704, 2706, 2707, 2714, 2717, 2720, 2722, 2726, 2731,
    2734, 2739, 2745, 2744, 2752, 2754, 2755, 2772, 2765, 2771,
    2776, 2782, 2784, 2787, 2795, 2802, 2805, 2810, 2818, 2830,
    2826, 2834, 2841, 2844, 2854, 2859, 2867, 2868, 2880, 2888,
    2893, 2903, 2910, 2914, 2924, 2936, 2943, 2946, 2895, 2808,
    2775, 2742, 2708, 2679, 2651, 2623, 2601, 2569, 2540, 2519,
    2495, 2469, 2448, 2425, 2402, 2382, 2361, 2340, 2314, 2299,
    2277, 2259, 2239, 2222, 2202, 2188, 2166, 2149, 2136, 2117,
    2100, 2087, 2067, 2056, 2041, 2023, 2012, 2001, 1990, 1970,
    1961, 1949, 1933, 1921, 1911, 1895, 1903, 1906, 1903, 1815,
    1756, 1740, 1731, 1719, 1709, 1701, 1689, 1682, 1675, 1661,
    1654, 1642, 1635, 1626, 1620, 1614, 1598, 1593, 1585, 1577,
    1570, 1564, 1553, 1543, 1542, 1533, 1524, 1519, 1510, 1506,
    1499, 1495, 1487, 1476, 1476, 1470, 1462, 1461, 1453, 1441,
    1441, 1432, 1429, 1420, 1418, 1411, 1404, 1400, 1397, 1394,
    1387, 1380, 1380, 1369, 1381, 1363, 1376, 1358, 1353, 1347,
    1347, 1338, 1339, 1329, 1334, 1333, 1325, 1310, 1316, 1310,
    1302, 1309, 1296, 1306, 1310, 1297, 1287, 1281, 1287, 1282,
    1278, 1278, 1267, 1262, 1268, 1268, 1261, 1256, 1250, 1252,
    1246, 1241, 1246, 1239, 1236, 1242, 1245, 1248, 1243, 1239,
    1233, 1236, 1228, 1232, 1220, 1227, 1226, 1221, 1230, 1217,
    1228, 1213, 1209, 1211, 1218, 1214, 1219, 1208, 1207, 1202,
    1205, 1208, 1207, 1207, 1199, 1208, 1202, 1200, 1193, 1203,
    1193, 1197, 1202, 1196, 1198, 1199, 1193, 1201, 1195, 1195,
    1197, 1200, 1196, 1200, 1198, 1194, 1197, 1192, 1192, 1193,
    1197, 1198, 1198, 1199, 1202, 1194, 1195, 1191, 1193, 1196,
    1196, 1198, 1194, 1198, 1199, 1194, 1201, 1198, 1202, 1197,
    1199, 1204, 1207, 1209, 1207, 1210, 1210, 1213, 1217, 1214,
    1214, 1215, 1217, 1221, 1223, 1221, 1223, 1223, 1228, 1231,
    1233, 1229, 1239, 1239, 1238, 1237, 1241, 1245, 1243, 1250,
    1250, 1254, 1256, 1255, 1259, 1258, 1263, 1269, 1273, 1274,
    1276, 1280, 1282, 1285, 1288, 1290, 1291, 1291, 1298, 1302,
    1305, 1310, 1314, 1319, 1323, 1322, 1332, 1335, 1337, 1341,
    1343, 1347, 1359, 1358, 1358, 1365, 1373, 0, 0, 18,
    193
  };
  for (int index = 0; index < TIM571_DATA_COUNT; index++) {
    distance[index] = dump[index];
  }
}

void create_test_rssi(uint8_t *rssi)
{
  uint16_t dump[] = {
    0, 0, 48, 5, 43, 76, 73, 98, 101, 101,
    98, 101, 101, 101, 104, 104, 104, 104, 107, 107,
    112, 107, 107, 109, 115, 115, 112, 112, 115, 118,
    112, 118, 118, 115, 118, 115, 121, 121, 121, 121,
    121, 121, 118, 121, 121, 121, 121, 126, 124, 126,
    129, 129, 129, 129, 129, 129, 126, 126, 126, 129,
    132, 132, 135, 135, 129, 132, 138, 135, 132, 129,
    129, 135, 132, 132, 135, 135, 138, 138, 135, 140,
    135, 138, 138, 140, 135, 101, 243, 112, 118, 121,
    126, 121, 118, 126, 121, 124, 121, 126, 121, 129,
    129, 135, 135, 132, 135, 135, 132, 132, 132, 135,
    132, 138, 132, 140, 138, 135, 138, 140, 149, 149,
    157, 152, 152, 155, 157, 152, 155, 152, 155, 155,
    152, 157, 157, 155, 157, 152, 149, 152, 152, 155,
    149, 155, 149, 160, 152, 152, 149, 157, 149, 152,
    152, 149, 149, 155, 155, 155, 157, 152, 155, 155,
    157, 157, 157, 155, 155, 152, 157, 155, 157, 157,
    149, 152, 152, 149, 149, 152, 155, 149, 146, 146,
    152, 146, 152, 152, 149, 143, 146, 146, 152, 143,
    149, 152, 143, 146, 149, 143, 149, 143, 143, 146,
    146, 143, 140, 146, 146, 143, 143, 140, 146, 143,
    140, 149, 146, 140, 146, 146, 143, 140, 143, 140,
    140, 143, 140, 140, 140, 138, 143, 138, 143, 143,
    140, 143, 138, 140, 143, 140, 140, 143, 140, 140,
    143, 143, 140, 140, 140, 140, 138, 140, 138, 140,
    138, 135, 138, 135, 138, 140, 135, 132, 135, 138,
    138, 135, 135, 135, 132, 132, 132, 129, 126, 129,
    129, 132, 132, 132, 132, 129, 126, 126, 129, 126,
    124, 124, 124, 126, 126, 124, 126, 121, 124, 124,
    121, 126, 118, 121, 115, 118, 115, 118, 115, 118,
    118, 121, 118, 115, 115, 118, 121, 118, 115, 115,
    118, 109, 115, 112, 112, 109, 115, 112, 112, 109,
    112, 109, 118, 149, 155, 149, 140, 146, 143, 149,
    155, 152, 140, 140, 146, 149, 152, 157, 149, 143,
    143, 138, 92, 118, 118, 115, 129, 149, 143, 118,
    121, 129, 124, 126, 126, 126, 129, 126, 132, 126,
    146, 160, 155, 157, 157, 155, 157, 155, 155, 163,
    163, 155, 157, 157, 160, 157, 160, 157, 166, 157,
    163, 166, 163, 160, 160, 163, 163, 163, 160, 163,
    163, 166, 160, 166, 163, 166, 166, 166, 163, 163,
    163, 160, 163, 166, 163, 166, 163, 169, 169, 169,
    166, 166, 163, 172, 163, 166, 163, 166, 163, 166,
    163, 166, 163, 169, 163, 166, 163, 166, 163, 166,
    166, 169, 169, 166, 166, 169, 169, 166, 163, 166,
    166, 166, 172, 163, 169, 166, 166, 163, 163, 166,
    169, 163, 166, 166, 166, 169, 163, 169, 163, 160,
    163, 163, 172, 166, 166, 166, 163, 166, 163, 163,
    163, 163, 160, 166, 166, 160, 163, 163, 160, 163,
    160, 160, 160, 160, 163, 160, 160, 163, 157, 163,
    157, 155, 169, 157, 160, 160, 160, 155, 155, 160,
    160, 157, 155, 157, 163, 155, 155, 155, 155, 157,
    155, 157, 149, 157, 155, 155, 155, 155, 152, 155,
    157, 152, 155, 138, 121, 126, 124, 121, 124, 126,
    124, 126, 126, 124, 129, 126, 135, 129, 129, 129,
    132, 135, 132, 135, 138, 138, 138, 135, 140, 146,
    146, 143, 140, 149, 143, 146, 146, 143, 146, 146,
    143, 143, 152, 152, 146, 149, 149, 152, 146, 152,
    155, 172, 160, 155, 146, 155, 152, 155, 152, 155,
    155, 155, 157, 157, 155, 157, 155, 157, 160, 160,
    157, 155, 157, 155, 160, 157, 163, 155, 155, 163,
    163, 160, 160, 157, 163, 160, 163, 160, 157, 160,
    163, 163, 166, 163, 157, 163, 160, 163, 163, 166,
    166, 163, 163, 166, 166, 163, 166, 169, 163, 172,
    166, 174, 166, 166, 166, 169, 166, 169, 163, 169,
    172, 172, 166, 172, 169, 166, 172, 169, 174, 177,
    174, 169, 169, 174, 174, 172, 174, 172, 169, 174,
    174, 174, 174, 174, 174, 172, 172, 174, 174, 174,
    177, 180, 183, 180, 180, 177, 180, 177, 180, 174,
    177, 180, 177, 183, 177, 186, 177, 177, 177, 183,
    183, 186, 180, 180, 177, 180, 183, 183, 183, 180,
    186, 183, 183, 177, 183, 180, 180, 183, 183, 180,
    183, 180, 186, 183, 183, 183, 186, 183, 183, 183,
    180, 169, 163, 166, 169, 174, 177, 174, 172, 172,
    166, 169, 166, 166, 166, 169, 166, 166, 166, 166,
    160, 163, 163, 163, 160, 160, 166, 163, 163, 166,
    166, 163, 160, 169, 166, 160, 160, 163, 163, 163,
    160, 160, 163, 163, 163, 163, 160, 169, 166, 166,
    163, 163, 163, 163, 166, 166, 166, 163, 163, 160,
    160, 163, 163, 166, 166, 160, 163, 166, 166, 166,
    163, 160, 163, 160, 163, 160, 163, 166, 166, 160,
    157, 163, 163, 163, 163, 160, 157, 163, 157, 152,
    152
  };
  for (int index = 0; index < TIM571_DATA_COUNT; index++) {
    rssi[index] = dump[index];
  }
}

void create_test_config(hough_config *config)
{
  config->distance_max = 15000;
  config->distance_step = 15;

  config->angle_step = 5;

  config->votes_min = 10;

  config->bad_distance = 0;
  config->bad_rssi = 0;
}

int main(int argc,char **argv)
{
  uint16_t distance[TIM571_DATA_COUNT];
  uint8_t rssi[TIM571_DATA_COUNT];
  tim571_status_data test_data;
  hough_config config;
  lines_data result;

  create_test_status_data(&test_data);
  create_test_config(&config);
  create_test_distance(distance);
  create_test_rssi(rssi);

  test_hough_methods(&config, &test_data, distance, rssi);

  hough_get_lines_data(&config, &test_data, distance, rssi, &result);
  hough_print_lines_data(&result);
  exit(0);
}
